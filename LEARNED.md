# üß≠ LEARNED.md ‚Äî Key Lessons Learned

## üí° –¢–µ—Ö–Ω—ñ—á–Ω—ñ —É—Ä–æ–∫–∏

1. –Ü–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å —á–µ—Ä–µ–∑ `ON CONFLICT DO NOTHING` ‚Äî –Ω–∞–π–ø—Ä–æ—Å—Ç—ñ—à–µ —Ä—ñ—à–µ–Ω–Ω—è –¥–ª—è ingestion.
2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π SQLAlchemy 2.0 –ø–æ–º—ñ—Ç–Ω–æ —à–≤–∏–¥—à–∏–π –ø—Ä–∏ –ø–∞–∫–µ—Ç–Ω–∏—Ö –≤—Å—Ç–∞–≤–∫–∞—Ö.
3. Alembic –º–æ–∂–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç–∏ —Ä–µ–≤—ñ–∑—ñ–π –º—ñ–∂ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ ‚Äî –≤–∞—Ä—Ç–æ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—é.
4. –ü–æ–º–∏–ª–∫–∞ `functions in index expression must be marked IMMUTABLE` –≤–∏—Ä—ñ—à—É—î—Ç—å—Å—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è–º —ñ–Ω–¥–µ–∫—Å—É.
5. Prometheus –Ω–µ –¥–æ–∑–≤–æ–ª—è—î –ø–æ–¥–≤—ñ–π–Ω–æ—ó —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –º–µ—Ç—Ä–∏–∫ ‚Äî —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≤ `metrics.py`.
6. JSON-–ª–æ–≥–∏ —á–µ—Ä–µ–∑ `logging` ‚Äî –ª–µ–≥–∫–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Grafana/Loki.
7. CLI-—ñ–º–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ `docker compose run --rm` ‚Äî —á–∏—Å—Ç–æ —Ç–∞ –∑—Ä—É—á–Ω–æ.

---

## üß† –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω—ñ —É—Ä–æ–∫–∏

- **Observability early:** –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ `/metrics` –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –∑ —Å–∞–º–æ–≥–æ –ø–æ—á–∞—Ç–∫—É.
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ—Å—Ç—å –º–∞—î —Å–µ–Ω—Å –ª–∏—à–µ –ø—ñ—Å–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó SQL.**
- **MVP simplicity:** PostgreSQL + FastAPI ‚Äî –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –Ω–∞ –ø–æ—á–∞—Ç–∫–æ–≤–æ–º—É –µ—Ç–∞–ø—ñ.
- **Migration hygiene:** –æ–¥–Ω–∞ –∑—ñ–ø—Å–æ–≤–∞–Ω–∞ —Ä–µ–≤—ñ–∑—ñ—è Alembic –º–æ–∂–µ –∑–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –¥–µ–ø–ª–æ–π.

---

## üî≠ –Ü–¥–µ—ó –¥–ª—è —Ä–æ–∑–≤–∏—Ç–∫—É

- –Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Grafana Dashboard.
- –î–æ–¥–∞—Ç–∏ Redis cache –¥–ª—è `/stats`.
- –í–∞–ª—ñ–¥–∞—Ü—ñ—è CSV —á–µ—Ä–µ–∑ Pydantic v2.
- –ù–æ–≤–∏–π endpoint `/stats/hourly-active`.
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Ç–µ—Å—Ç–∏ —É GitHub Actions.
